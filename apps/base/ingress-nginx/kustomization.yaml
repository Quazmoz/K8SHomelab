apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
resources:
  - https://raw.githubusercontent.com/kubernetes/ingress-nginx/controller-v1.14.1/deploy/static/provider/cloud/deploy.yaml

patches:
  # Use Cluster traffic policy for stable MetalLB announcement
  # This allows any speaker to announce the IP without strict leader election
  # Trade-off: Client source IP is not preserved (SNAT'd)
  - patch: |-
      apiVersion: v1
      kind: Service
      metadata:
        name: ingress-nginx-controller
        namespace: ingress-nginx
      spec:
        externalTrafficPolicy: Cluster