# Unla MCP Gateway Server Configurations
# These are mounted as startup configurations for GitOps management
# Format: https://docs.unla.amoylab.com/en/configuration/gateways
#
# To add a new server:
# 1. Add it to mcpServers section
# 2. Add a router for it
# 3. Commit and push - Flux will apply it

name: "homelab-mcp-servers"
tenant: "default"

routers:
  # Azure MCP Server route
  - server: "azure-mcp"
    prefix: "/gateway/azure"
    cors:
      allowOrigins:
        - "*"
      allowMethods:
        - "GET"
        - "POST"
        - "OPTIONS"
      allowHeaders:
        - "Content-Type"
        - "Authorization"
        - "Mcp-Session-Id"
        - "mcp-protocol-version"
      exposeHeaders:
        - "Mcp-Session-Id"
        - "mcp-protocol-version"
      allowCredentials: true

  # Filesystem MCP Server route (example)
  - server: "filesystem"
    prefix: "/gateway/filesystem"
    cors:
      allowOrigins:
        - "*"
      allowMethods:
        - "GET"
        - "POST"
        - "OPTIONS"
      allowHeaders:
        - "Content-Type"
        - "Authorization"
        - "Mcp-Session-Id"
      exposeHeaders:
        - "Mcp-Session-Id"
      allowCredentials: true

mcpServers:
  # Azure MCP Server - runs as stdio subprocess
  # Requires Azure credentials as environment variables
  - type: "stdio"
    name: "azure-mcp"
    command: "npx"
    args:
      - "-y"
      - "@azure/mcp@latest"
      - "server"
      - "start"
    env:
      AZURE_TENANT_ID: "{{ env \"AZURE_TENANT_ID\" }}"
      AZURE_CLIENT_ID: "{{ env \"AZURE_CLIENT_ID\" }}"
      AZURE_CLIENT_SECRET: "{{ env \"AZURE_CLIENT_SECRET\" }}"

  # Filesystem MCP Server - example of another stdio server
  - type: "stdio"
    name: "filesystem"
    command: "npx"
    args:
      - "-y"
      - "@modelcontextprotocol/server-filesystem"
      - "/data"
