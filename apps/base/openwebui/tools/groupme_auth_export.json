[
    {
        "id": "groupme_auth",
        "name": "Auth Registration",
        "content": "\nimport requests\nimport json\nfrom pydantic import BaseModel, Field\n\nclass Tools:\n    class Valves(BaseModel):\n        BACKEND_URL: str = Field(\n            default=\"http://groupme-backend.apps.svc.cluster.local:5000/auth/register\",\n            description=\"Internal URL for GroupMe backend registration endpoint\"\n        )\n\n    class UserValves(BaseModel):\n        REGISTRATION_TOKEN: str = Field(\n            default=\"\",\n            description=\"Paste your GroupMe Access Token here to register it, then run the 'Register Token' command.\"\n        )\n\n    def __init__(self):\n        self.valves = self.Valves()\n        self.user_valves = self.UserValves()\n\n    def _get_user_valves(self, __user__: dict) -> UserValves:\n        \"\"\"Safely extract user valves.\"\"\"\n        try:\n            valves_dict = __user__.get(\"valves\", {})\n            return self.UserValves(**valves_dict)\n        except Exception:\n            return self.UserValves()\n\n    async def register_token(self, __user__: dict = {}) -> str:\n        \"\"\"\n        Securely register the token you saved in the Tool Settings (UserValves).\n        \"\"\"\n        user_valves = self._get_user_valves(__user__)\n        token = user_valves.REGISTRATION_TOKEN\n\n        if not token:\n            return \"\u274c Error: No token found. Please go to **Workspace > Tools > Auth Registration > Gear Icon** and paste your token in the 'REGISTRATION_TOKEN' field.\"\n\n        # Get OpenWebUI JWT from the user context\n        jwt = __user__.get(\"token\", \"\")\n        if not jwt:\n            return \"Error: Could not retrieve your OpenWebUI session token. Please try refreshing the page.\"\n\n        url = self.valves.BACKEND_URL\n        headers = {\n            \"Authorization\": f\"Bearer {jwt}\",\n            \"Content-Type\": \"application/json\"\n        }\n        payload = {\n            \"groupme_token\": token\n        }\n\n        try:\n            response = requests.post(url, headers=headers, json=payload, timeout=10)\n            if response.status_code == 200:\n                return \"\u2705 Success! Your GroupMe token has been securely registered. It is now encrypted in the backend database. You can clear the token from the settings now.\"\n            else:\n                return f\"\u274c Registration failed (Status {response.status_code}): {response.text}\"\n        except Exception as e:\n            return f\"\u274c Connection error: {str(e)}\"\n",
        "description": "Helper tool to register your API tokens securely with the backend.",
        "access_control": null,
        "meta": {
            "description": "Helper tool to register your API tokens securely with the backend.",
            "manifest": {
                "title": "Auth Registration",
                "url": "https://quinnfavo.com",
                "version": "1.0.0",
                "author": "Antigravity",
                "description": "Helper tool to register your API tokens securely with the backend."
            }
        }
    }
]